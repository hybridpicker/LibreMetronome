/**
 * Enhanced Color Blindness Accommodation Styles
 *
 * Different color schemes for various types of color vision deficiencies:
 * - Protanopia (red-blind)
 * - Deuteranopia (green-blind)
 * - Tritanopia (blue-blind)
 * - Monochromacy (complete color blindness)
 * 
 * These styles ensure that both standard HTML elements and SVG elements
 * are properly adjusted for different color vision deficiencies.
 */

/* Base override styles for all color blindness modes */
body.color-blind {
  /* Reset main colors to more friendly palette */
  --background-main: #ffffff;
  --text-primary: #000000;
}

/* Apply color transformations to all images, including SVG images */
body.color-blind img {
  transition: filter 0.3s ease;
}

/* Protanopia (red-blind) - images and SVGs */
body.protanopia img {
  filter: grayscale(0.5) sepia(0.4) hue-rotate(140deg) saturate(0.8);
}

/* Deuteranopia (green-blind) - images and SVGs */
body.deuteranopia img {
  filter: grayscale(0.4) sepia(0.6) hue-rotate(40deg) saturate(0.9);
}

/* Tritanopia (blue-blind) - images and SVGs */
body.tritanopia img {
  filter: grayscale(0.4) sepia(0.5) hue-rotate(200deg) saturate(0.7);
}

/* Monochromacy (complete color blindness) - images and SVGs */
body.monochromacy img {
  filter: grayscale(1);
}

/* Also target specific SVG selectors */
body.color-blind svg,
body.color-blind svg image,
body.color-blind object[type="image/svg+xml"],
body.color-blind embed[type="image/svg+xml"],
body.color-blind iframe[src$=".svg"] {
  transition: filter 0.3s ease;
}

/* Protanopia (red-blind) - specific SVG targets */
body.protanopia svg,
body.protanopia svg image,
body.protanopia object[type="image/svg+xml"],
body.protanopia embed[type="image/svg+xml"],
body.protanopia iframe[src$=".svg"] {
  filter: grayscale(0.5) sepia(0.4) hue-rotate(140deg) saturate(0.8);
}

/* Deuteranopia (green-blind) - specific SVG targets */
body.deuteranopia svg,
body.deuteranopia svg image,
body.deuteranopia object[type="image/svg+xml"],
body.deuteranopia embed[type="image/svg+xml"],
body.deuteranopia iframe[src$=".svg"] {
  filter: grayscale(0.4) sepia(0.6) hue-rotate(40deg) saturate(0.9);
}

/* Tritanopia (blue-blind) - specific SVG targets */
body.tritanopia svg,
body.tritanopia svg image,
body.tritanopia object[type="image/svg+xml"],
body.tritanopia embed[type="image/svg+xml"],
body.tritanopia iframe[src$=".svg"] {
  filter: grayscale(0.4) sepia(0.5) hue-rotate(200deg) saturate(0.7);
}

/* Monochromacy (complete color blindness) - specific SVG targets */
body.monochromacy svg,
body.monochromacy svg image,
body.monochromacy object[type="image/svg+xml"],
body.monochromacy embed[type="image/svg+xml"],
body.monochromacy iframe[src$=".svg"] {
  filter: grayscale(1);
}

/* Apply to beat icons, play/pause buttons, and other specific UI elements */
body.color-blind .beat-icon, 
body.color-blind .play-pause-icon,
body.color-blind .tap-button img,
body.color-blind .control-button img {
  transition: filter 0.3s ease;
}

/* Protanopia (red-blind) - specific UI elements */
body.protanopia .beat-icon,
body.protanopia .play-pause-icon,
body.protanopia .tap-button img,
body.protanopia .control-button img {
  filter: grayscale(0.5) sepia(0.4) hue-rotate(140deg) saturate(0.8);
}

/* Deuteranopia (green-blind) - specific UI elements */
body.deuteranopia .beat-icon,
body.deuteranopia .play-pause-icon,
body.deuteranopia .tap-button img,
body.deuteranopia .control-button img {
  filter: grayscale(0.4) sepia(0.6) hue-rotate(40deg) saturate(0.9);
}

/* Tritanopia (blue-blind) - specific UI elements */
body.tritanopia .beat-icon,
body.tritanopia .play-pause-icon,
body.tritanopia .tap-button img,
body.tritanopia .control-button img {
  filter: grayscale(0.4) sepia(0.5) hue-rotate(200deg) saturate(0.7);
}

/* Monochromacy (complete color blindness) - specific UI elements */
body.monochromacy .beat-icon,
body.monochromacy .play-pause-icon,
body.monochromacy .tap-button img,
body.monochromacy .control-button img {
  filter: grayscale(1);
}

/* Protanopia (red-blind) */
body.protanopia {
  /* First beat indicators - use blue instead of red */
  --beat-first: #0072B2;
  --beat-first-hover: #005C8F;
  
  /* Accent colors - enhance yellow and blues */
  --beat-accent: #E69F00;
  --beat-accent-hover: #B57D00;
  
  /* Normal beat - use darker blue */
  --beat-normal: #009E73;
  --beat-normal-hover: #007A57;
  
  /* Primary colors */
  --primary-teal: #0072B2;
  --primary-teal-dark: #005C8F;
  --primary-teal-light: #56B1DC;
  
  /* Secondary colors */
  --secondary-gold: #E69F00;
  --secondary-gold-dark: #B57D00;
  --secondary-gold-light: #FFD163;
  
  /* Status colors - use patterns plus colors */
  --status-success: #009E73;
  --status-warning: #E69F00;
  --status-error: #000000;
}

/* Deuteranopia (green-blind) */
body.deuteranopia {
  /* First beat indicators - use blue tones */
  --beat-first: #3F51B5;
  --beat-first-hover: #303F9F;
  
  /* Accent colors - enhance oranges */
  --beat-accent: #FF9800;
  --beat-accent-hover: #F57C00;
  
  /* Normal beat - use darker blue */
  --beat-normal: #0288D1;
  --beat-normal-hover: #0277BD;
  
  /* Primary colors */
  --primary-teal: #3F51B5;
  --primary-teal-dark: #303F9F;
  --primary-teal-light: #7986CB;
  
  /* Secondary colors */
  --secondary-gold: #FF9800;
  --secondary-gold-dark: #F57C00;
  --secondary-gold-light: #FFB74D;
  
  /* Status colors - use patterns plus colors */
  --status-success: #0288D1;
  --status-warning: #FF9800;
  --status-error: #000000;
}

/* Tritanopia (blue-blind) */
body.tritanopia {
  /* First beat indicators - use reds */
  --beat-first: #D32F2F;
  --beat-first-hover: #C62828;
  
  /* Accent colors - enhance yellows */
  --beat-accent: #FFB300;
  --beat-accent-hover: #FFA000;
  
  /* Normal beat - use darker browns */
  --beat-normal: #8D6E63;
  --beat-normal-hover: #795548;
  
  /* Primary colors */
  --primary-teal: #D32F2F;
  --primary-teal-dark: #C62828;
  --primary-teal-light: #EF5350;
  
  /* Secondary colors */
  --secondary-gold: #FFB300;
  --secondary-gold-dark: #FFA000;
  --secondary-gold-light: #FFCA28;
  
  /* Status colors - use patterns plus colors */
  --status-success: #8D6E63;
  --status-warning: #FFB300;
  --status-error: #D32F2F;
}

/* Monochromacy (complete color blindness) */
body.monochromacy {
  /* All beat indicators - use different shades of gray */
  --beat-first: #000000;
  --beat-first-hover: #333333;
  
  --beat-accent: #555555;
  --beat-accent-hover: #777777;
  
  --beat-normal: #999999;
  --beat-normal-hover: #BBBBBB;

  --beat-muted: #DDDDDD;
  
  /* Primary colors */
  --primary-teal: #000000;
  --primary-teal-dark: #333333;
  --primary-teal-light: #555555;
  
  /* Secondary colors */
  --secondary-gold: #777777;
  --secondary-gold-dark: #999999;
  --secondary-gold-light: #BBBBBB;
  
  /* Status colors - use different shapes plus grayscale */
  --status-success: #000000;
  --status-warning: #777777;
  --status-error: #DDDDDD;
}

/* Add patterns to help distinguish between elements in colorblind modes */
body.color-blind .beat-dot:first-child::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background-color: #fff;
}

body.color-blind .beat-dot.accented::before {
  content: '';
  position: absolute;
  top: -2px;
  right: -2px;
  bottom: -2px;
  left: -2px;
  border: 2px dotted #fff;
  border-radius: 50%;
}

/* High contrast overrides */
body.color-blind.high-contrast {
  --background-main: #000000;
  --text-primary: #ffffff;
  
  --beat-first: #ffffff;
  --beat-first-hover: #cccccc;
  
  --beat-accent: #cccccc;
  --beat-accent-hover: #aaaaaa;
  
  --beat-normal: #aaaaaa;
  --beat-normal-hover: #888888;
  
  --beat-muted: #555555;
}

/* Add different patterns for each button/status type */
body.color-blind.high-contrast .beat-dot:first-child {
  position: relative;
  overflow: visible;
}

/* Target the specific beat icons in the metronome to apply additional visual patterns */
body.color-blind .metronome-container {
  position: relative;
}

/* Add visual patterns for the different beat types */
body.color-blind .metronome-container img[src*="firstBeat.svg"],
body.color-blind .metronome-container img[src*="firstBeatActive.svg"] {
  position: relative;
  border: 2px solid white !important;
  box-sizing: content-box;
  box-shadow: 0 0 3px rgba(255,255,255,0.8) !important;
}

body.color-blind .metronome-container img[src*="accentedBeat.svg"],
body.color-blind .metronome-container img[src*="accentedBeatActive.svg"] {
  position: relative;
  border: 1px dashed white !important;
  box-sizing: content-box;
  box-shadow: 0 0 2px rgba(255,255,255,0.6) !important;
}

/* Ensure the play/pause and tap buttons have sufficient contrast */
body.color-blind .play-pause-button img,
body.color-blind .tap-button img {
  filter: drop-shadow(0 0 2px rgba(0,0,0,0.5));
  transform: scale(1.05);
}

/* Add specific styles for the analog metronome in color blind mode */
body.color-blind canvas {
  filter: contrast(1.1);
}

/* Enhanced patterns for metronome elements */
body.color-blind .metronome-circle circle {
  stroke-width: var(--stroke-width, 2px);
  transition: stroke 0.3s, fill 0.3s;
}

body.color-blind .beat-indicator {
  position: relative;
}

/* Add distinct patterns to differentiate beat types in circle mode */
body.color-blind .beat-indicator[data-beat-type="first"]::after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 30%;
  height: 30%;
  background: #fff;
  border-radius: 50%;
  pointer-events: none;
}

body.color-blind .beat-indicator[data-beat-type="accent"]::after {
  content: "";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 40%;
  height: 40%;
  border: 2px solid #fff;
  border-radius: 50%;
  pointer-events: none;
}

/* Special handling for Grid mode in color blind modes */
body.color-blind .grid-cell {
  position: relative;
}

body.color-blind .grid-cell[data-accent="3"]::after {
  content: "1";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 0.7em;
  color: #fff;
  pointer-events: none;
}

body.color-blind .grid-cell[data-accent="2"]::after {
  content: "●";
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 0.6em;
  color: #fff;
  pointer-events: none;
}

/* Special handling for polyrhythm mode */
body.color-blind .polyrhythm-circle {
  position: relative;
}

body.color-blind .polyrhythm-circle circle {
  transition: stroke 0.3s, fill 0.3s;
}

/* Fix SVG icons in buttons */
body.color-blind button svg,
body.color-blind .btn svg,
body.color-blind .icon svg {
  filter: var(--svg-filter);
}

/* Ensure proper contrast for controls */
body.color-blind .mode-selector button,
body.color-blind .control-panel button {
  border: 1px solid var(--text-primary);
}

/* Fix specific SVG elements in metronome components */
body.color-blind .pendulum svg,
body.color-blind .slider svg,
body.color-blind .tempo-display svg {
  filter: var(--svg-filter);
}

/* Add specific patterns for other SVG-based elements */
body.color-blind .metronome-svg-container svg .beat-marker {
  stroke-width: 2;
  transition: fill 0.3s, stroke 0.3s;
}
